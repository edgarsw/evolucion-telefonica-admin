<p-toast />
<p-confirmdialog />
<p-table #tablaClientes [value]="clientes" stripedRows size="small" [globalFilterFields]="globalFilterFields"
    [tableStyle]="{ 'min-width': '50rem' }" [scrollable]="true">

    <ng-template #caption>
        <div class="flex justify-between">
            <p-button label="Agregar" [outlined]="true" icon="pi pi-user-plus" (onClick)="onAddClick()" />
            <div class="flex items-center gap-2">
                <p-button severity="secondary" label="Limpiar" [outlined]="true" icon="pi pi-filter-slash"
                    (click)="clear(tablaClientes, searchInput)" />
                <p-iconfield iconPosition="left" class="ml-auto">
                    <p-inputicon>
                        <i class="pi pi-search"></i>
                    </p-inputicon>
                    <input #searchInput pInputText type="text"
                        (input)="tablaClientes.filterGlobal(searchInput.value, 'contains')" placeholder="Buscar..." />
                </p-iconfield>
            </div>
        </div>
    </ng-template>

    <ng-template #header>
        <tr>
            <th class="whitespace-nowrap">Activo</th>
            <th class="whitespace-nowrap">Razón Social</th>
            <th class="whitespace-nowrap">RFC</th>
            <th class="whitespace-nowrap">Calle</th>
            <th class="whitespace-nowrap">N° Exterior</th>
            <th class="whitespace-nowrap">N° Interior</th>
            <th class="whitespace-nowrap">Colonia</th>
            <th class="whitespace-nowrap">Estado</th>
            <th class="whitespace-nowrap">Ciudad</th>
            <th class="whitespace-nowrap">Municipio</th>
            <th class="whitespace-nowrap">C.P.</th>
            <th class="whitespace-nowrap">Celular</th>
            <th class="whitespace-nowrap">Teléfono Fijo</th>
            <th class="whitespace-nowrap">Correo</th>
            <th class="whitespace-nowrap">Facebook</th>
            <th pFrozenColumn alignFrozen="right"></th>
        </tr>
    </ng-template>

    <ng-template #body let-rowData>
        <tr>
            <td class="whitespace-nowrap">{{ rowData.clienteactivo }}</td>
            <td class="whitespace-nowrap">{{ rowData.nombre }}</td>
            <td class="whitespace-nowrap">{{ rowData.rfc }}</td>
            <td class="whitespace-nowrap">{{ rowData.calle }}</td>
            <td class="whitespace-nowrap">{{ rowData.numexterior }}</td>
            <td class="whitespace-nowrap">{{ rowData.numinterior }}</td>
            <td class="whitespace-nowrap">{{ rowData.colonia }}</td>
            <td class="whitespace-nowrap">{{ rowData.estado }}</td>
            <td class="whitespace-nowrap">{{ rowData.ciudad }}</td>
            <td class="whitespace-nowrap">{{ rowData.municipio }}</td>
            <td class="whitespace-nowrap">{{ rowData.cp }}</td>
            <td class="whitespace-nowrap">{{ rowData.telefono }}</td>
            <td class="whitespace-nowrap">{{ rowData.telefonofijo }}</td>
            <td class="whitespace-nowrap">{{ rowData.correo }}</td>
            <td class="whitespace-nowrap">{{ rowData.facebook }}</td>
            <td class="whitespace-nowrap" pFrozenColumn alignFrozen="right">
                <p-button icon="pi pi-pencil" class="mr-2" [rounded]="true" [outlined]="true"
                    (click)="editClient(rowData)" size="small" />
                <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [outlined]="true"
                    (click)="deleteProduct($event, rowData)" size="small" />
            </td>
        </tr>
    </ng-template>
</p-table>
<p-dialog [(visible)]="editVisible" [modal]="true" header="Editar cliente"
    [style]="{ width: '900px', maxWidth: '95vw' }" [draggable]="false" [resizable]="false" (onHide)="cancelEdit()">

    <form #editForm="ngForm" (ngSubmit)="saveEdit(editForm)" [class.submitted]="editForm.submitted" class="mt-2">
        <div class="flex flex-wrap gap-6">
            <!-- Columna 1 -->
            <div class="flex-1 flex flex-col gap-3 min-w-[300px]">
                <p-floatlabel variant="on">
                    <input pInputText id="nombre" name="nombre" [(ngModel)]="editCliente.nombre" required
                        maxlength="300" autocomplete="off" class="w-full"
                        [ngClass]="{'p-invalid': editForm.submitted && editForm.controls['nombre'].invalid}" />
                    <label for="nombre">Nombre Fiscal <span class="text-red-500">*</span></label>
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <input pInputText id="rfc" name="rfc" [(ngModel)]="editCliente.rfc" maxlength="300"
                        autocomplete="off" class="w-full" />
                    <label for="rfc">RFC</label>
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <input pInputText id="calle" name="calle" [(ngModel)]="editCliente.calle" required maxlength="300"
                        autocomplete="off" class="w-full"
                        [ngClass]="{'p-invalid': editForm.submitted && editForm.controls['calle'].invalid}" />
                    <label for="calle">Calle <span class="text-red-500">*</span></label>
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <input pInputText id="numexterior" name="numexterior" [(ngModel)]="editCliente.numexterior"
                        required maxlength="300" autocomplete="off" class="w-full"
                        [ngClass]="{'p-invalid': editForm.submitted && editForm.controls['numexterior'].invalid}" />
                    <label for="numexterior">N° Exterior <span class="text-red-500">*</span></label>
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <input pInputText id="numinterior" name="numinterior" [(ngModel)]="editCliente.numinterior"
                        maxlength="300" autocomplete="off" class="w-full" />
                    <label for="numinterior">N° Interior</label>
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <input pInputText id="colonia" name="colonia" [(ngModel)]="editCliente.colonia" required
                        maxlength="300" autocomplete="off" class="w-full"
                        [ngClass]="{'p-invalid': editForm.submitted && editForm.controls['colonia'].invalid}" />
                    <label for="colonia">Colonia <span class="text-red-500">*</span></label>
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <p-select id="estado" name="estado" [(ngModel)]="editCliente.estado" [options]="estados"
                        optionLabel="name" optionValue="name" class="w-full"
                        [ngClass]="{'p-invalid': editForm.submitted && !editCliente.estado}"></p-select>
                    <label for="estado">Estado <span class="text-red-500">*</span></label>
                    <input type="text" name="estado_hidden" [(ngModel)]="editCliente.estado" required hidden />
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <p-select id="ciudad" name="ciudad" [(ngModel)]="editCliente.ciudad" [options]="ciudades"
                        optionLabel="name" optionValue="name" class="w-full"
                        [ngClass]="{'p-invalid': editForm.submitted && !editCliente.ciudad}"></p-select>
                    <label for="ciudad">Ciudad <span class="text-red-500">*</span></label>
                    <input type="text" name="ciudad_hidden" [(ngModel)]="editCliente.ciudad" required hidden />
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <input pInputText id="municipio" name="municipio" [(ngModel)]="editCliente.municipio"
                        maxlength="300" autocomplete="off" class="w-full" />
                    <label for="municipio">Municipio</label>
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <p-inputnumber class="w-full" 
                        id="cp" 
                        name="cp" 
                        [(ngModel)]="editCliente.cp" 
                        [useGrouping]="false" 
                        required 
                        [maxlength]="5"
                        autocomplete="off" 
                        [ngClass]="{'p-invalid': editForm.submitted && editForm.controls['cp'].invalid}" 
                    />
                    <label for="cp">Código Postal <span class="text-red-500">*</span></label>
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <p-inputnumber class="w-full"
                        id="telefono" 
                        name="telefono" 
                        [(ngModel)]="editCliente.telefono" 
                        [useGrouping]="false" 
                        required
                        [maxlength]="10" 
                        autocomplete="off" 
                        [ngClass]="{'p-invalid': editForm.submitted && editForm.controls['telefono'].invalid}" 
                    />
                    <label for="telefono">N° Teléfono Celular <span class="text-red-500">*</span></label>
                </p-floatlabel>

                <div class="flex items-center h-[2rem] gap-2 pl-1">
                    <p-checkbox inputId="isfoto" name="isfoto" binary="true"
                        [(ngModel)]="editCliente.isfoto"></p-checkbox>
                    <label for="isfoto">Foto forzosa</label>
                </div>

                <div class="flex items-center h-[2rem] gap-2 pl-1">
                    <p-checkbox inputId="iscomercial" name="iscomercial" binary="true"
                        [(ngModel)]="editCliente.iscomercial"></p-checkbox>
                    <label for="iscomercial">Cliente Comercial <span class="text-red-500">*</span></label>
                </div>
            </div>

            <!-- Columna 2 -->
            <div class="flex-1 flex flex-col gap-3 min-w-[300px]">
                <p-floatlabel variant="on">
                    <p-inputnumber id="telefonofijo" name="telefonofijo" [(ngModel)]="editCliente.telefonofijo" [useGrouping]="false" required
                        [maxlength]="10" autocomplete="off" class="w-full"
                        [ngClass]="{'p-invalid': editForm.submitted && editForm.controls['telefonofijo'].invalid}"
                    />
                    <label for="telefonofijo">N° Teléfono Fijo <span class="text-red-500">*</span></label>
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <input pInputText id="correo" name="correo" [(ngModel)]="editCliente.correo" required
                        maxlength="300" autocomplete="off" class="w-full"
                        [ngClass]="{'p-invalid': editForm.submitted && editForm.controls['correo'].invalid}" />
                    <label for="correo">Correo Electrónico <span class="text-red-500">*</span></label>
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <input pInputText id="facebook" name="facebook" [(ngModel)]="editCliente.facebook" maxlength="300"
                        autocomplete="off" class="w-full" />
                    <label for="facebook">Facebook</label>
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <p-inputnumber id="precioconsigna" name="precioconsigna" [(ngModel)]="editCliente.precioconsigna"
                        required autocomplete="off" class="w-full" [maxFractionDigits]="5"
                        [ngClass]="{'p-invalid': editForm.submitted && editForm.controls['precioconsigna'].invalid}"/>
                    <label for="precioconsigna">Precio consigna <span class="text-red-500">*</span></label>
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <input pInputText id="latitud" name="latitud" [(ngModel)]="editCliente.latitud" autocomplete="off"
                        class="w-full" />
                    <label for="latitud">Latitud</label>
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <input pInputText id="longitud" name="longitud" [(ngModel)]="editCliente.longitud"
                        autocomplete="off" class="w-full" />
                    <label for="longitud">Longitud</label>
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <p-select id="idzona" name="idzona" [(ngModel)]="editCliente.idzona" [options]="zonas"
                        optionLabel="name" optionValue="name" class="w-full"></p-select>
                    <label for="idzona">Zona</label>
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <input pInputText id="giro" name="giro" [(ngModel)]="editCliente.giro" required maxlength="300"
                        autocomplete="off" class="w-full"
                        [ngClass]="{'p-invalid': editForm.submitted && editForm.controls['giro'].invalid}" />
                    <label for="giro">Giro <span class="text-red-500">*</span></label>
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <p-select id="clasificacion" name="clasificacion" [(ngModel)]="editCliente.clasificacion"
                        [options]="tipoClientes" optionLabel="name" optionValue="name" class="w-full"
                        [ngClass]="{'p-invalid': editForm.submitted && !editCliente.clasificacion}"></p-select>
                    <label for="clasificacion">Tipo cliente <span class="text-red-500">*</span></label>
                    <input type="text" name="clasificacion_hidden" [(ngModel)]="editCliente.clasificacion" required
                        hidden />
                </p-floatlabel>

                <p-floatlabel variant="on">
                    <textarea pInputTextarea id="referencia" name="referencia" [(ngModel)]="editCliente.referencia"
                        rows="3" cols="30" class="w-full resize-none h-[7rem]"></textarea>
                    <label for="referencia">Referencia</label>
                </p-floatlabel>
            </div>
        </div>

        <div class="mt-4 flex justify-end gap-2">
            <button pButton type="button" label="Cancelar" class="p-button-outlined" (click)="cancelEdit()"></button>
            <button pButton type="submit" label="Guardar"></button>
        </div>
    </form>
</p-dialog>